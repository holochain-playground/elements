{"version":3,"file":"lit-context.cjs.development.js","sources":["../src/types/context.ts","../src/lib/context.ts","../src/lib/context-provider.ts","../src/lib/context-consumer.ts","../src/decorators/consume.ts","../src/lib/context-creator.ts"],"sourcesContent":["/**\n * Copyright (c) 2020 Dorian Cortes, Gary Valverde\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\ninterface IContext {\n    getValue(): object\n    setValue(newValue: object): void\n}\n\nexport type MapFn<T = object> = (providerNewValue?: T, providerOldValue?: T) => void;\n\nexport class Context implements IContext {\n    value: object;\n    subscriptions: Set<Function>;\n\n    constructor(initialValue: object) {\n        this.value = initialValue;\n        this.subscriptions = new Set<Function>()\n    }\n\n    getValue() {\n        return this.value;\n    }\n\n    setValue(newValue: object) {\n        const oldValue = this.value;\n        this.value = newValue;\n        this.subscriptions?.forEach(subscription => subscription(newValue, oldValue));\n    }\n}","/**\n * Copyright (c) 2020 Dorian Cortes, Gary Valverde\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { Context } from \"../types/context\";\n\n/**\n * \n * @param initialValue \n * @return { Context }\n */\nexport function createContext(initialValue: object): Context {\n  const context = new Context(initialValue);\n  return context;\n}\n\nexport function consumeContext(context: Context, callback: Function) {\n  /**\n   * Get the subscriptions to a context\n   */\n  const { subscriptions } = context;\n  /**\n   * Add the new subscription\n   */\n  subscriptions?.add(callback);\n  /**\n   * \n   */\n  callback(context?.getValue());\n\n  return () => {\n    subscriptions?.delete(callback);\n  }\n}\n\n","/**\n * Copyright (c) 2020 Dorian Cortes, Gary Valverde\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { LitElement, html, property } from 'lit-element';\nimport { createContext } from './context';\nimport { Context } from '../types/context';\n\n/**\n * Context Provider\n * @class\n */\nexport class ContextProvider extends LitElement {\n  @property({ type: Context })\n  context: Context;\n\n  @property({ type: Object })\n  value: object = {};\n\n  constructor() {\n    super();\n    this.context = createContext(this.value);\n  }\n\n  render() {\n    this.context.setValue(this.value);\n    return html`\n      <slot></slot>\n    `;\n  }\n}\n","/**\n * Copyright (c) 2020 Dorian Cortes, Gary Valverde\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { consumeContext } from \"./context\";\nimport { ContextProvider } from \"./context-provider\";\nimport { MapFn } from \"../types/context\";\n\n/**\n * Context Consumer\n * @param providerTag\n * @param consumer \n * @param mapFn \n */\nexport const contextConsumer = <T = object>(providerTag: string, consumer: Element, mapFn?: MapFn<T>) => {\n  let provider: ContextProvider | null = null;\n  let node: Element | null = consumer;\n\n  do {\n    let slot: Boolean = node.assignedSlot instanceof HTMLSlotElement;\n    /**\n     * Find the node's closest provider tag\n     */\n    provider = node?.closest(providerTag);\n\n    /**\n     * If within a slot \n     */\n    let parentIsSlotted;\n    if (slot && provider === null) {\n      provider = node?.assignedSlot?.closest(providerTag) || null;\n      /**\n       * If provider remains null\n       */\n      if (provider === null) {\n        /**\n         * Then check if the parent node of the slotted element is slotted as well\n         */\n        parentIsSlotted = node?.parentElement?.assignedSlot instanceof HTMLSlotElement;\n      }\n    }\n\n    /**\n     * Find the root node\n     */\n    let root: Element | ShadowRoot | null = node?.getRootNode() as ShadowRoot;\n\n    /**\n     * If within a slot\n     */\n    if (slot && root === null) {\n      root = node?.assignedSlot?.getRootNode() as ShadowRoot || null;\n    } \n    /**\n     * Set the node to the root host\n     */\n    node = parentIsSlotted ? node?.parentElement : root?.host;\n  } while (!provider && node);\n\n  /**\n   * If there's a valid provider\n   */\n  if (provider) {\n    /**\n     * Register the context to be consumed\n     */\n    const unsubscribe = consumeContext(provider.context, (providerNewValue: T, providerOldValue: T) => {\n      if (!consumer.isConnected) {\n        unsubscribe();\n      } else if (mapFn instanceof Function) {\n        mapFn.call(consumer, providerNewValue, providerOldValue);\n      } else {\n        Object.assign(consumer, providerNewValue);\n      }\n    });\n  }\n};","/**\n * Copyright (c) 2020 Dorian Cortes, Gary Valverde\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { contextConsumer } from \"../lib/context-consumer\";\nimport { MapFn } from \"../types/context\";\n\n/**\n * @param providerTag Provider tag name\n * @param mapFn  Function to map provider value\n */\nexport type Constructor<T> = {\n    // tslint:disable-next-line:no-any\n    new(...args: any[]): T\n};\n\n// From the TC39 Decorators proposal\ninterface ClassDescriptor {\n    kind: 'class';\n    elements: ClassElement[];\n    finisher?: <T>(clazz: Constructor<T>) => undefined | Constructor<T>;\n}\n\n// From the TC39 Decorators proposal\ninterface ClassElement {\n    kind: 'field' | 'method';\n    key: PropertyKey;\n    placement: 'static' | 'prototype' | 'own';\n    initializer?: Function;\n    extras?: ClassElement[];\n    finisher?: <T>(clazz: Constructor<T>) => undefined | Constructor<T>;\n    descriptor?: PropertyDescriptor;\n}\n\nexport const consume = <T = object>(providerTag: string, mapFn?: MapFn<T>) =>\n    (classOrDescriptor: Constructor<HTMLElement> | ClassDescriptor) =>\n        (typeof classOrDescriptor === 'function') ?\n            legacyCustomElement<T>(classOrDescriptor, providerTag, mapFn) :\n            standardCustomElement<T>(classOrDescriptor, providerTag, mapFn);\n\nconst legacyCustomElement =\n    <T = object>(classConstructor: Constructor<HTMLElement>, providerTag: string, mapFn?: MapFn<T>) => {\n        const consumer = (consumer: HTMLElement, mapFn?: MapFn<T>) => contextConsumer(providerTag, consumer, mapFn);\n        return class extends classConstructor {\n            connectedCallback() {\n                super.connectedCallback();\n                consumer(this, mapFn);\n            }\n        } as any\n    };\n\nconst standardCustomElement =\n    <T = object>(classConstructor: ClassDescriptor, providerTag: string, mapFn?: MapFn<T>) => {\n        const { kind, elements } = classConstructor;\n        const consumer = (consumer: HTMLElement, mapFn?: MapFn<T>) => contextConsumer(providerTag, consumer, mapFn);\n        return {\n            kind,\n            elements,\n            finisher(clazz: Constructor<HTMLElement>) {\n                clazz.prototype.__litContextConnectedCallback = clazz.prototype.connectedCallback;\n                clazz.prototype.connectedCallback = function connectedCallbackHandler() {\n                  this.__litContextConnectedCallback();\n                  consumer(this, mapFn);\n                };\n            }\n        };\n    };","/**\n * Copyright (c) 2020 Dorian Cortes, Gary Valverde\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport { ContextProvider } from \"./context-provider\";\nimport { contextConsumer } from \"./context-consumer\";\nimport { consume } from '../decorators/consume';\nimport { MapFn } from \"../types/context\";\n\n/**\n * @param providerTagName Provider name (Note: It will be used to generate its custom element tag name)\n * @returns Context information and consume functionalities\n */\nexport const createContext = (providerName: string, defaultValue: object = {}) => {\n  const tagName = providerName + '-provider';\n\n  if (!customElements.get(tagName)) {\n    customElements.define(tagName, class extends ContextProvider {\n      value: object = defaultValue;\n    });\n  }\n\n  return {\n    getTagName: (): string => tagName,\n    consumer: (consumer: HTMLElement, mapFn?: MapFn) => contextConsumer(tagName, consumer, mapFn),\n    consume: (mapFn?: MapFn) => consume(tagName, mapFn) as any\n  }\n}"],"names":["Context","constructor","initialValue","value","subscriptions","Set","getValue","setValue","newValue","oldValue","forEach","subscription","createContext","context","consumeContext","callback","add","delete","ContextProvider","LitElement","render","html","__decorate","property","type","Object","contextConsumer","providerTag","consumer","mapFn","provider","node","slot","assignedSlot","HTMLSlotElement","closest","parentIsSlotted","parentElement","root","getRootNode","host","unsubscribe","providerNewValue","providerOldValue","isConnected","Function","call","assign","consume","classOrDescriptor","legacyCustomElement","standardCustomElement","classConstructor","connectedCallback","kind","elements","finisher","clazz","prototype","__litContextConnectedCallback","connectedCallbackHandler","providerName","defaultValue","tagName","customElements","get","define","getTagName"],"mappings":"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"}