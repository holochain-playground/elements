<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        background: #fafafa;
        font-family: Arial, Helvetica, sans-serif;
      }
    </style>
  </head>
  <body>
    <holochain-playground-container id="container">
      <dht-cells
        id="cells"
        step-by-step
        style="height: 600px; width: 100%"
      ></dht-cells>
      <source-chain style="height: 350px; width: 100%"></source-chain>
      <call-zome-fns
        hide-zome-selector
        hide-agent-pub-key
        style="height: 350px; width: 100%"
        id="call-zome"
      ></call-zome-fns>
    </holochain-playground-container>

    <script type="module">
      import { html, render } from 'lit-html';
      import {
        HolochainPlaygroundContainer,
        CallZomeFns,
        SourceChain,
        DhtCells,
        EntryGraph,
      } from '../dist';
      import {
        WorkflowType,
        NetworkRequestType,
      } from '@holochain-playground/core';

      const dna = {
        zomes: [
          {
            name: 'sample',
            entry_defs: [
              {
                id: 'sample_entry',
                visibility: 'Public',
              },
            ],
            zome_functions: {
              create_cap: {
                call: ({ create_cap_grant }) => ({ grantedAgent }) => {
                  return create_cap_grant({
                    tag: '',
                    access: {
                      Assigned: {
                        secret: '',
                        assignees: [grantedAgent],
                      },
                    },
                    functions: [{ zome: 'sample', fn_name: 'sample_fn' }],
                  });
                },
                arguments: [{ type: 'AgentPubKey', name: 'grantedAgent' }],
              },
              sample_fn: {
                call: ({ create_entry }) => async () => {
                  await create_entry({
                    content: 'hi',
                    entry_def_id: 'sample_entry',
                  });

                  return 'Hello';
                },
                arguments: [],
              },
              revoke_cap: {
                call: ({ delete_cap_grant }) => ({ capGrantToRevoke }) => {
                  return delete_cap_grant({ header_hash: capGrantToRevoke });
                },
                arguments: [{ type: 'HeaderHash', name: 'capGrantToRevoke' }],
              },
              remote_sample_fn: {
                call: ({ call_remote }) => ({ agentToCall }) => {
                  return call_remote({
                    agent: agentToCall,
                    zome: 'sample',
                    fn_name: 'sample_fn',
                    cap: null,
                    payload: null,
                  });
                },
                arguments: [{ type: 'AgentPubKey', name: 'agentToCall' }],
              },
            },
          },
        ],
      };

      customElements.define(
        'holochain-playground-container',
        HolochainPlaygroundContainer
      );
      customElements.define('dht-cells', DhtCells);
      customElements.define('call-zome-fns', CallZomeFns);
      customElements.define('source-chain', SourceChain);
      customElements.define('entry-graph', EntryGraph);

      const container = document.getElementById('container');
      container.numberOfSimulatedConductors = 3;
      container.simulatedDnaTemplate = dna;

      container.addEventListener('ready', (e) => {
        const conductor = e.detail.conductors[0];

        const cellId = conductor.getAllCells()[0].cellId;

        container.activeDna = cellId[0];
      });

      const dhtCells = document.getElementById('cells');
      //      dhtCells.workflowsToDisplay = [WorkflowType.CALL_ZOME];
      dhtCells.networkRequestsToDisplay = [NetworkRequestType.CALL_REMOTE];
    </script>
  </body>
</html>
